<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Parcel Sorting with Full-Screen Overlay</title>
  <!-- Make it mobile-friendly -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
    }

    h1 {
      text-align: center;
    }

    #app {
      max-width: 600px;
      margin: 0 auto;
      text-align: center;
    }

    input[type="text"] {
      width: 100%;
      padding: 10px;
      font-size: 1.2rem;
      box-sizing: border-box;
    }

    #message {
      margin-top: 20px;
      font-size: 1.5rem;
      font-weight: bold;
      min-height: 3rem;
      display: flex;
      justify-content: center;
      align-items: center;
      transition: background-color 0.3s;
    }

    /* Just for the normal message display (when not using the overlay) */
    .info {
      color: #333;
      background-color: #f0f0f0;
    }

    /* Fullscreen overlay styling */
    #overlay {
      /* Start off hidden */
      display: none;
      /* Fill the entire browser window */
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      /* Place it above other elements */
      z-index: 9999; 
      /* Use Flexbox to center content */
      display: flex; 
      align-items: center;
      justify-content: center;
      /* A default background to override in .success/.error */
      background-color: rgba(0, 0, 0, 0.8);
      text-align: center;
      padding: 20px;
    }

    /* Success (green) full-screen overlay */
    #overlay.success {
      background-color: rgba(76, 175, 80, 0.95); /* Green-ish */
    }

    /* Error (red) full-screen overlay */
    #overlay.error {
      background-color: rgba(244, 67, 54, 0.95); /* Red-ish */
    }

    /* Overlay text content */
    #overlay-content {
      color: #fff;
      font-size: 2rem;
      font-weight: bold;
      max-width: 90%;
    }

    /* Make sure input and text scale on small screens */
    @media (max-width: 600px) {
      input[type="text"] {
        font-size: 1rem;
      }
      #overlay-content {
        font-size: 1.5rem;
      }
    }
  </style>
</head>
<body>

  <h1>Parcel Sorting - Two Step</h1>
  <div id="app">
    <p>Current Step: <strong id="current-step">Scan Package</strong></p>
    <input
      type="text"
      id="scanner-input"
      placeholder="Scan here..."
      autofocus
    />
    <div id="message" class="info">
      Please scan the package barcode.
    </div>
  </div>

  <!-- Fullscreen overlay (initially hidden) -->
  <div id="overlay">
    <div id="overlay-content">Message goes here</div>
  </div>

  <!-- Success and Error sounds (optional) -->
  <audio id="success-sound" src="success.mp3" preload="auto"></audio>
  <audio id="error-sound" src="error.mp3" preload="auto"></audio>

  <script>
    // 1. Carrier Config
    const carriers = [
      { prefix: "0034", name: "DHL", bin: "1050" },
      { prefix: "8064", name: "GLS", bin: "1070" },
      // Add more carriers here
    ];

    // 2. State Variables
    let currentStep = "scanPackage"; // "scanPackage" or "scanBin"
    let expectedBin = null;

    // 3. DOM Elements
    const scannerInput = document.getElementById("scanner-input");
    const messageDiv = document.getElementById("message");
    const currentStepLabel = document.getElementById("current-step");
    const overlay = document.getElementById("overlay");
    const overlayContent = document.getElementById("overlay-content");

    const successSound = document.getElementById("success-sound");
    const errorSound = document.getElementById("error-sound");

    // 4. Set up event listener for scanning (change event or key event)
    scannerInput.addEventListener("change", handleScan);

    function handleScan() {
      const code = scannerInput.value.trim();
      // Clear the input for the next scan
      scannerInput.value = "";

      if (!code) return;

      if (currentStep === "scanPackage") {
        handlePackageScan(code);
      } else if (currentStep === "scanBin") {
        handleBinScan(code);
      }
    }

    // 5a. Handle Package Scan
    function handlePackageScan(barcode) {
      const carrier = carriers.find(c => barcode.startsWith(c.prefix));

      if (!carrier) {
        // Unknown or invalid
        showMessage("ERROR: Unknown carrier!", false);
        showOverlay("Unknown carrier!", false);
        return;
      }

      expectedBin = carrier.bin;

      // Ask user to scan the bin
      showMessage(`Package: ${carrier.name}. Please scan bin ${carrier.bin}.`, true);
      showOverlay(`Package: ${carrier.name}. Now scan bin ${carrier.bin}...`, true);

      currentStep = "scanBin";
      updateStepLabel();
    }

    // 5b. Handle Bin Scan
    function handleBinScan(scannedBin) {
      if (scannedBin === expectedBin) {
        // Correct bin
        showMessage("Correct Bin! Sorting Complete.", true);
        showOverlay("Correct Bin! Sorting Complete.", true);
      } else {
        // Wrong bin
        showMessage(`ERROR: Wrong bin! Expected ${expectedBin}.`, false);
        showOverlay(`Wrong bin! Expected ${expectedBin}...`, false);
        // Remain in "scanBin" so user can try again
        return;
      }

      // Reset to the next package
      currentStep = "scanPackage";
      expectedBin = null;
      updateStepLabel();
    }

    // 6. UI Helper: Show bottom message (existing)
    function showMessage(msg, isSuccess) {
      messageDiv.textContent = msg;
      messageDiv.classList.remove("info"); 
      if (isSuccess) {
        messageDiv.style.backgroundColor = "#4CAF50"; // green
        messageDiv.style.color = "#fff";
        playSuccessSound();
      } else {
        messageDiv.style.backgroundColor = "#f44336"; // red
        messageDiv.style.color = "#fff";
        playErrorSound();
      }
    }

    // 7. UI Helper: Show Fullscreen Overlay
    function showOverlay(msg, isSuccess) {
      // Reset classes
      overlay.classList.remove("success", "error");

      if (isSuccess) {
        overlay.classList.add("success");
        playSuccessSound();
      } else {
        overlay.classList.add("error");
        playErrorSound();
      }

      overlayContent.textContent = msg;

      // Display the overlay
      overlay.style.display = "flex";

      // Hide after 2 seconds (or adjust to your preference)
      setTimeout(() => {
        overlay.style.display = "none";
      }, 2000);
    }

    function updateStepLabel() {
      currentStepLabel.textContent = 
        currentStep === "scanPackage" ? "Scan Package" : "Scan Bin";
    }

    function playSuccessSound() {
      successSound.currentTime = 0;
      successSound.play();
    }

    function playErrorSound() {
      errorSound.currentTime = 0;
      errorSound.play();
    }
  </script>
</body>
</html>
